<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Интерактивная карта</title>
	<meta name="description" content="">
	<meta name="keywords" content="">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/media.css">
	<link rel="stylesheet" href="css/fonts.css">
	<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style>
		/* Стили оставлены без изменений */
	</style>
</head>
<body>
	<header>
		<h1>Интерактивная карта школы</h1>
		<div id="auth">
			<button onclick="showLoginModal()" id="loginBtn">Войти</button>
			<span id="welcome" style="display:none;">Добро пожаловать, <strong id="userDisplay"></strong>!</span>
			<button id="logoutBtn" onclick="logout()">Выйти</button>
		</div>
	</header>

	<div class="welcome-banner fade-in">
		<h2>Добро пожаловать на интерактивную карту школы!</h2>
		<p>Этот проект создан в рамках практики. Здесь вы можете посмотреть расположение кабинетов, узнать информацию о преподавателях и оставить свои заметки.</p>
		<img src="media/Polish Cow Cow GIF - Polish Cow Cow Dancing - Discover & Share GIFs.gif" alt="Тссс" class="banner-img">
	</div>

	<div class="map-container">
		<div class="map">
			<!-- SVG оставлен без изменений -->
			<div class="tooltip" id="tooltip"></div>
			<div class="description"></div>
			<img src="media/building-plan.jpg" alt="План здания" style="width:100%;">
		</div>
	</div>

	<div id="loginModal">
		<div class="modal-content">
			<h2>Вход</h2>
			<input type="text" id="username" placeholder="Имя пользователя">
			<br><br>
			<button onclick="login()">Войти</button>
		</div>
	</div>

	<footer>
		<p>&copy; 2025 МБОУ ООШ №26. Все права защищены.</p>
	</footer>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script>
		let currentUser = null;

		function showLoginModal() {
			document.getElementById('loginModal').style.display = 'flex';
		}

		function login() {
			const name = document.getElementById('username').value.trim();
			if (!name) return alert('Введите имя пользователя');
			currentUser = name;
			document.getElementById('welcome').style.display = 'inline';
			document.getElementById('userDisplay').textContent = currentUser;
			document.getElementById('logoutBtn').style.display = 'inline';
			document.getElementById('loginBtn').style.display = 'none';
			document.getElementById('loginModal').style.display = 'none';
		}

		function logout() {
			currentUser = null;
			document.getElementById('welcome').style.display = 'none';
			document.getElementById('logoutBtn').style.display = 'none';
			document.getElementById('loginBtn').style.display = 'inline';
			document.getElementById('username').value = '';
		}

		$(document).ready(function () {
			$('svg .part').on('mouseover', function (e) {
				const room = $(this).data('room');
				const description = $(this).data('desc');
				const tooltip = $('#tooltip');
				const offset = $('.map').offset();

				tooltip.html(`<img src="media/${room.replace(' ', '_')}.jpg" alt="${room}"><strong>${room}</strong><p>${description}</p>`)
					.css({ top: e.pageY - offset.top + 10, left: e.pageX - offset.left + 10 })
					.show();
			});

			$('svg .part').on('mouseout', function () {
				$('#tooltip').hide();
			});

			$('svg .part').on('mousemove', function (e) {
				const offset = $('.map').offset();
				$('#tooltip').css({ top: e.pageY - offset.top + 10, left: e.pageX - offset.left + 10 });
			});

			$('svg .part').on('dblclick', function (e) {
				if (!currentUser) return alert('Пожалуйста, войдите перед добавлением метки.');

				const offset = $('.map').offset();
				const x = e.pageX - offset.left;
				const y = e.pageY - offset.top;
				const room = $(this).data('room') || 'Кабинет';

				const form = $('<div class="note-form"></div>').css({ top: y + 10, left: x + 10 });
				form.append(`<strong>${room}</strong><br>`);
				form.append('<textarea placeholder="Введите информацию..."></textarea>');
				const addButton = $('<button>Добавить</button>');
				const cancelButton = $('<button style="background:#ccc;">Отмена</button>');

				addButton.on('click', function () {
					const message = form.find('textarea').val();
					if (!message.trim()) return;

					const display = $('<div class="note-display"></div>').css({ top: y + 10, left: x + 10 });
					display.html(`<button title="Удалить">×</button><strong>${room}</strong><br><em>${currentUser}</em>: ${message}`);

					display.find('button').on('click', function () {
						display.remove();
					});

					$('.map').append(display);
					form.remove();
				});

				cancelButton.on('click', function () {
					form.remove();
				});

				form.append(addButton);
				form.append(cancelButton);
				$('.map').append(form);
			});

			// Блокировка перехода по ссылке в svg
			$('svg a').on('click', function (e) {
				e.preventDefault();
			});
		});
	</script>
</body>
</html>
